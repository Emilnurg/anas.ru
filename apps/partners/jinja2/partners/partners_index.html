{%- extends 'layouts/main.html' -%}

{%- block PAGE_TITLE %}{{ partners_page.title|e }}{% endblock -%}

{%- block BODY_CLASSES %}body-partners{% endblock -%}

{%- block PAGE_CONTENT -%}
<div class="b-partners">
	<div class="container">
		<div class="main-title">
			<h3>{{ partners_page.title }}</h3>
			{%- if partners_page.subtitle -%}
			<div class="content--block">{{ partners_page.subtitle }}</div>
			{%- endif -%}
		</div>
		{%- if partners -%}
		<div class="partners-filter">
			<div class="partners-filter__dropdowns">
				<div class="dropdown">
					<button class="dropdown__button" data-toggle="dropdown">Выберите город</button>
					<div class="dropdown-menu">
						<div>
							{%- for col in cities|slice(2) -%}
							<div>
								<ul>
									{%- for city in col -%}
									<li>
										<a href="javascript:">{{ city.title }}</a>
									</li>
									{%- endfor -%}
								</ul>
							</div>
							{%- endfor -%}
						</div>
					</div>
				</div>
				<div class="dropdown">
					<button class="dropdown__button" type="button" data-toggle="dropdown"> Выберите направление </button>
					<div class="dropdown-menu">
						<div>
							{%- for col in professional_areas|slice(2) -%}
							<div>
								<ul>
									{%- for area in col -%}
									<li>
										<a href="javascript:">{{ area.title }}</a>
									</li>
									{%- endfor -%}
								</ul>
							</div>
							{%- endfor -%}
						</div>
					</div>
				</div>
			</div>
			<div class="partners-filter__types">
				<a href="javascript:" class="btn btn--map">Карта</a>
				<a href="javascript:" class="btn btn--list is-active">Список</a>
			</div>
		</div>
		<script type="application/javascript">
			function initMap()
			{
				var map = new google.maps.Map(document.getElementById('map'),
				{
					zoom: 3,
					scrollwheel: false,
					center: {
						lat: 62.5763605,
						lng: 93.33995625
					}
				});
				var infoWin = new google.maps.InfoWindow();
				var markers = locations.map(function(location, i) {
					var marker = new google.maps.Marker({
						position: location
					});
					google.maps.event.addListener(marker, 'click', function() {
						infoWin.setContent(location.info);
						infoWin.open(map, marker);
					});
					return marker;
				});
				// Add a marker clusterer to manage the markers.
				var clusterStyles = [
				{
					textColor: 'white',
					url: '{{ STATIC_URL }}images/marker.svg',
					textSize: 18,
					height: 51,
					width: 36,
					iconAnchor: [17, 51]
				},
				{
					textColor: 'white',
					url: '{{ STATIC_URL }}images/marker.svg',
					textSize: 18,
					height: 51,
					width: 36,
					iconAnchor: [17, 51]
				},
				{
					textColor: 'white',
					url: '{{ STATIC_URL }}images/marker.svg',
					textSize: 18,
					height: 51,
					width: 36,
					iconAnchor: [17, 51]
				},
				{
					textColor: 'white',
					url: '{{ STATIC_URL }}images/marker.svg',
					textSize: 18,
					height: 51,
					width: 36,
					iconAnchor: [17, 51]
				},
				{
					textColor: 'white',
					url: '{{ STATIC_URL }}images/marker.svg',
					textSize: 18,
					height: 51,
					width: 36,
					iconAnchor: [17, 58]
				}];
				var mcOptions = {
					gridSize: 36,
					styles: clusterStyles,
					maxZoom: 15
				};
				var markerCluster = new MarkerClusterer(map, markers, mcOptions);
			}
			var locations = [
			{%- for partner in partners %}
			{%- if partner.map_x and partner.map_y -%}
			{ {#-  -#}
				lat: {{ partner.map_y }}, {#-  -#}
				lng: {{ partner.map_x }}, {#-  -#}
				info: '<div class="map-info">' {%- if partner.city_id -%} +
					'<div class="map-info__city">' +
						'{{ partner.city.title }}' +
					'</div>' {%- endif -%} +
					'<div class="map-info__company">' +
						'{{ partner.title }}' +
					'</div>' {%- if partner.address -%} +
					'<address class="map-info__address">' +
						'129090, 2-й Троицкий пер., д. 6а, стр. 13' +
					'</address>' {%- endif -%}{%- if partner.phone -%} +
					'<div class="map-info__phones">' +
						'{{ partner.phone }}' +
					'</div>' {%- endif -%} {%- if partner.website -%} +
					'<div class="map-info__site">' +
						'{{ partner.website }}' +
					'</div>' {%- endif -%} +
				'</div>'
			}
			{%- endif -%}
			{%- if not loop.last %},{% endif -%}
			{%- endfor -%}
			]
		</script>

		<script src="{{ STATIC_URL }}js/partials/markerclusterer.js"></script>
		<script async defer
						src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDGgAHCr6yyc5mrD9QyXJxFZd8LJtTZ2lM&callback=initMap">
		</script>

		<div class="partners-map">
			<div class="map">
				<div id="map"></div>
			</div>
		</div>
		<div class="partners-table-wrap table-wrap is-active">
			<table class="table partners-table is-active">
				<thead>
					<tr>
						<th>Город</th>
						<th>Компания</th>
						<th>Адрес</th>
						<th>Телефон</th>
						<th>Сайт</th>
					</tr>
				</thead>
				<tbody>
					{%- for partner in partners -%}
					<tr data-city="{{ partner.city_id if partner.city_id else '' }}"
							data-profs="|{% for area in partner.professional_areas_cache %}{{ area.pk }}|{% endfor %}|">
						<td>{{ partner.city.title if partner.city_id else '&nbsp;' }}</td>
						<td>{{ partner.title }}</td>
						<td>{{ partner.address or '&nbsp;' }}</td>
						<td>{{ partner.phone or '&nbsp;' }}</td>
						<td>{{ partner.website or '&nbsp;' }}</td>
					</tr>
					{%- endfor -%}
				</tbody>
			</table>
		</div>
		{%- endif -%}
	</div>
</div>

{%- if partners_page.howto_title -%}
<div class="b-become-dealer">
	<div class="b-become-dealer__parallax">
		<div></div>
	</div>

	<div class="container">
		<div class="section-title">
			<h4>{{ partners_page.howto_title }}</h4>
			{%- if partners_page.howto_subtitle -%}
			<p>{{ partners_page.howto_subtitle }}</p>
			{%- endif -%}
		</div>
		<div class="b-become-dealer__text">
			{%- if partners_page.howto_body -%}
			<div class="content-block">{{ partners_page.howto_body }}</div>
			{%- endif -%}
			{%- if partners_page.howto_button_caption -%}
			<a href="#form" class="btn">{{ partners_page.howto_button_caption }}</a>
			{%- endif -%}
		</div>
	</div>
</div>
{%- endif -%}

<div class="b-feedback b-feedback2">
	<div class="container">
		<div class="row">
			<div class="col-lg-6">
				<div class="b-feedback__contacts">
					{%- if partners_page.questions_title_left -%}
					<h4>{{ partners_page.questions_title_left }}</h4>
					{%- endif -%}

					{%- if var('TELEPHONE_PUBLIC', request) -%}
					<div>
						<a href="tel:+74956265455" class="b-feedback__tel">+7 (495) 626-54-55</a>
					</div>
					{%- endif -%}

					{%- if var('EMAIL_PUBLIC', request) -%}
					<div>
						<a href="mailto:{{ var('EMAIL_PUBLIC', request) }}" class="b-feedback__email">
							{{- var('EMAIL_PUBLIC', request) -}}
						</a>
					</div>
					{%- endif -%}
				</div>
			</div>

			<div class="col-lg-6">
				<a name="form"></a>
				<form action="{{ url('forms:feedback', kwargs={'lang': request.LANGUAGE_CODE}) }}"
							class="form contacts__form" method="POST" accept-charset="utf-8" novalidate>
					{{- csrf_input -}}
					<div class="form__heading">
						{%- if partners_page.questions_title -%}
						<h4>{{ partners_page.questions_title }}</h4>
						{%- endif -%}
						{%- if partners_page.questions_subtitle -%}
						<p>{{ partners_page.questions_subtitle }}</p>
						{%- endif -%}
						<div class="messages"></div>
					</div>

					<div class="form__content">
					<input type="hidden" name="place" value="partners"/>
						<div class="form__group">
							<input type="text" name="name" class="form__field required" id="partners-form-name">
							<label for="partners-form-name" class="form__placeholder">Имя</label>
							<div class="form__err"></div>
						</div>
						<div class="form__group">
							<input type="text" name="telephone" class="form__field required" id="partners-form-telephone">
							<label for="partners-form-telephone" class="form__placeholder">Телефон</label>
							<div class="form__err"></div>
						</div>
						<div class="form__group">
							<input type="text" name="comment" class="form__field required" id="partners-form-comment">
							<label for="partners-form-comment" class="form__placeholder">Комментарии</label>
							<div class="form__err"></div>
						</div>
					</div>

					<div class="form__button">
						<button type="submit" class="btn btn--black">Отправить</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
{%- endblock -%}
